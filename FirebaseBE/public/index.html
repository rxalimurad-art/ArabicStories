<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arabic Stories Admin</title>
  <link rel="stylesheet" href="admin.css">
  <style>
    /* Format selector styling */
    .format-selector-inline {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .format-selector-inline label {
      font-weight: 600;
      color: var(--gray-700);
      white-space: nowrap;
    }
    
    .format-selector-inline select {
      padding: 10px 16px;
      border: 2px solid var(--primary);
      border-radius: 8px;
      font-size: 15px;
      background: white;
      min-width: 180px;
    }
    
    .format-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .format-badge.mixed {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }
    
    .format-badge.bilingual {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
    }
    
    /* Segment styling based on format */
    .segment-card.mixed-format {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border: 2px solid #4caf50;
    }
    
    .segment-card.bilingual-format {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border: 2px solid #2196f3;
    }
    
    .segment-format-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: inline-block;
    }
    
    .segment-card.mixed-format .segment-format-label {
      color: #2e7d32;
    }
    
    .segment-card.bilingual-format .segment-format-label {
      color: #1565c0;
    }
    
    /* Content parts in mixed format */
    .content-parts-container {
      background: rgba(255,255,255,0.5);
      border-radius: 8px;
      padding: 12px;
      margin: 12px 0;
    }
    
    .content-part {
      background: white;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .content-part[data-type="arabicWord"] {
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      border-color: #ff9800;
      border-left: 4px solid #ff9800;
    }
    
    .content-part[data-type="text"] {
      border-left: 4px solid #9e9e9e;
    }
    
    .part-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .part-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .content-part[data-type="arabicWord"] .part-label {
      color: #e65100;
    }
    
    .content-part[data-type="text"] .part-label {
      color: #616161;
    }
    
    .part-type-badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 12px;
      font-weight: 600;
    }
    
    .content-part[data-type="arabicWord"] .part-type-badge {
      background: #ff9800;
      color: white;
    }
    
    .content-part[data-type="text"] .part-type-badge {
      background: #9e9e9e;
      color: white;
    }
    
    .remove-part {
      background: #f44336;
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      line-height: 1;
    }
    
    .segment-actions {
      display: flex;
      gap: 8px;
      padding: 12px;
      background: rgba(0,0,0,0.03);
      border-radius: 8px;
      margin-top: 8px;
    }
    
    .segment-actions button {
      font-size: 12px;
      padding: 8px 16px;
    }
    
    /* Word card with audio */
    .word-audio-input {
      width: 100%;
    }
    
    /* Simplified form sections */
    .form-section.compact {
      padding: 16px;
    }
    
    .form-section-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .form-section-title h3 {
      margin: 0;
    }
    
    .format-display {
      font-size: 13px;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 600;
    }
    
    /* Audio input tabs */
    .audio-input-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .audio-tab {
      flex: 1;
      padding: 8px 16px;
      border: 2px solid var(--gray-300);
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .audio-tab:hover {
      border-color: var(--primary);
    }
    
    .audio-tab.active {
      border-color: var(--primary);
      background: var(--primary);
      color: white;
    }
    
    .audio-panel {
      animation: fadeIn 0.2s ease;
    }
    
    .upload-progress {
      margin-top: 8px;
      height: 4px;
      background: var(--gray-200);
      border-radius: 2px;
      overflow: hidden;
    }
    
    .upload-progress-bar {
      height: 100%;
      background: var(--primary);
      border-radius: 2px;
      transition: width 0.3s ease;
    }
    
    /* Import words preview */
    .words-preview-list {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 12px;
    }
    
    .word-preview-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      background: var(--gray-100);
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    .word-preview-arabic {
      font-size: 18px;
      font-weight: 600;
      min-width: 100px;
    }
    
    .word-preview-info {
      flex: 1;
      font-size: 13px;
      color: var(--gray-600);
    }
    
    .word-preview-status {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 12px;
    }
    
    .word-preview-status.pending {
      background: var(--warning);
      color: white;
    }
    
    .word-preview-status.success {
      background: var(--success);
      color: white;
    }
    
    .word-preview-status.error {
      background: var(--danger);
      color: white;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- App Header -->
    <header class="app-header">
      <div class="header-brand">
        <h1>üïå Arabic Stories Admin</h1>
      </div>
      <nav class="header-nav">
        <button class="nav-btn active" data-view="stories">üìö Stories</button>
        <button class="nav-btn" data-view="create">‚ûï New Story</button>
        <button class="nav-btn" data-view="words">üìù Words</button>
        <button class="nav-btn" data-view="import">üì§ Import</button>
      </nav>
      <div class="header-actions">
        <button id="settings-btn" class="btn btn-icon" title="API Settings">‚öôÔ∏è</button>
      </div>
    </header>

    <main class="app-main">
      <!-- Stories List View -->
      <div id="stories-view" class="view">
        <div class="view-header">
          <h2>üìö All Stories</h2>
          <div class="search-box">
            <input type="text" id="story-search" placeholder="Search stories...">
            <select id="story-format-filter">
              <option value="">All Formats</option>
              <option value="mixed">üéØ Single (Mixed)</option>
              <option value="bilingual">üìñ Bilingual</option>
            </select>
            <button id="refresh-stories" class="btn btn-icon">üîÑ</button>
          </div>
        </div>
        
        <div id="stories-list" class="stories-grid">
          <div class="loading">Loading stories...</div>
        </div>
        
        <div id="stories-pagination" class="pagination hidden">
          <button id="prev-page" class="btn btn-secondary">Previous</button>
          <span id="page-info">Page 1</span>
          <button id="next-page" class="btn btn-secondary">Next</button>
        </div>
      </div>

      <!-- Create/Edit Story View -->
      <div id="create-view" class="view hidden">
        <div class="view-header">
          <h2 id="form-title">‚ûï Create New Story</h2>
          <div class="form-actions">
            <button id="validate-btn" class="btn btn-secondary">Validate</button>
            <button id="save-draft-btn" class="btn btn-secondary">Save Draft</button>
            <button id="publish-btn" class="btn btn-primary">Publish Story</button>
          </div>
        </div>

        <form id="story-form" class="story-form">
          <input type="hidden" id="story-id">
          <!-- Basic Info Section -->
          <section class="form-section compact">
            <div class="form-section-title">
              <h3>üìñ Basic Information</h3>
              <span id="current-format-display" class="format-display mixed">üéØ Single</span>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="story-title">Title (English) *</label>
                <input type="text" id="story-title" required placeholder="Story title">
              </div>
              <div class="form-group">
                <label for="story-title-arabic">Title (Arabic)</label>
                <input type="text" id="story-title-arabic" dir="rtl" placeholder="ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÇÿµÿ©">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-wide">
                <label for="story-desc">Description (English) *</label>
                <textarea id="story-desc" rows="2" required placeholder="Brief description of the story"></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-wide">
                <label for="story-desc-arabic">Description (Arabic)</label>
                <textarea id="story-desc-arabic" rows="2" dir="rtl" placeholder="ŸàÿµŸÅ ŸÖŸàÿ¨ÿ≤ ŸÑŸÑŸÇÿµÿ©"></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="story-author">Author *</label>
                <input type="text" id="story-author" required placeholder="Author name">
              </div>
              <div class="form-group format-selector-inline">
                <label for="story-format">Format *</label>
                <select id="story-format" required>
                  <option value="mixed">üéØ Single (Mixed)</option>
                  <option value="bilingual">üìñ Bilingual</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="story-difficulty">Difficulty Level *</label>
                <select id="story-difficulty" required>
                  <option value="1">Level 1 - Beginner</option>
                  <option value="2">Level 2 - Elementary</option>
                  <option value="3">Level 3 - Intermediate</option>
                  <option value="4">Level 4 - Advanced</option>
                  <option value="5">Level 5 - Expert</option>
                </select>
              </div>
              <div class="form-group">
                <label for="story-category">Category *</label>
                <select id="story-category" required>
                  <option value="general">General</option>
                  <option value="folktale">Folktale</option>
                  <option value="history">History</option>
                  <option value="science">Science</option>
                  <option value="culture">Culture</option>
                  <option value="adventure">Adventure</option>
                  <option value="mystery">Mystery</option>
                  <option value="romance">Romance</option>
                  <option value="children">Children</option>
                  <option value="religious">Religious</option>
                  <option value="poetry">Poetry</option>
                  <option value="modern">Modern</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="story-tags">Tags (comma separated)</label>
                <input type="text" id="story-tags" placeholder="beginner, vocabulary, mixed">
              </div>
              <div class="form-group form-group-wide">
                <label for="story-cover">Cover Image URL</label>
                <input type="url" id="story-cover" placeholder="https://example.com/image.jpg">
              </div>
            </div>
          </section>

          <!-- Story Segments Section -->
          <section class="form-section">
            <div class="section-header">
              <h3 id="segments-section-title">üìù Story Segments</h3>
              <button type="button" id="add-segment-btn" class="btn btn-small btn-primary">+ Add Segment</button>
            </div>
            
            <div id="segments-container">
              <!-- Segments will be added here dynamically -->
            </div>
            
            <div id="empty-segments" class="empty-state">
              <p>No segments yet. Click "Add Segment" to start building your story.</p>
            </div>
          </section>
        </form>

        <!-- Validation Results -->
        <div id="validation-results" class="validation-panel hidden">
          <h4>Validation Results</h4>
          <div id="validation-content"></div>
        </div>
      </div>

      <!-- Words List View -->
      <div id="words-view" class="view hidden">
        <div class="view-header">
          <h2>üìù General Words</h2>
          <div class="search-box">
            <input type="text" id="word-search" placeholder="Search words...">
            <select id="word-category-filter">
              <option value="">All Categories</option>
            </select>
            <select id="word-difficulty-filter">
              <option value="">All Levels</option>
              <option value="1">Level 1</option>
              <option value="2">Level 2</option>
              <option value="3">Level 3</option>
              <option value="4">Level 4</option>
              <option value="5">Level 5</option>
            </select>
            <button id="refresh-words" class="btn btn-icon">üîÑ</button>
            <button id="add-word-main-btn" class="btn btn-primary">+ Add Word</button>
          </div>
        </div>
        
        <div id="words-list" class="words-grid">
          <div class="loading">Loading words...</div>
        </div>
        
        <div id="words-pagination" class="pagination hidden">
          <button id="word-prev-page" class="btn btn-secondary">Previous</button>
          <span id="word-page-info">Page 1</span>
          <button id="word-next-page" class="btn btn-secondary">Next</button>
        </div>
      </div>

      <!-- Import/Export View -->
      <div id="import-view" class="view hidden">
        <div class="view-header">
          <h2>üì§ Import / Export</h2>
        </div>

        <div class="import-export-grid">
          <section class="form-section">
            <h3>üì• Import Story</h3>
            <p>Import a story from JSON file</p>
            
            <div class="form-group">
              <label for="import-file">Select JSON file</label>
              <input type="file" id="import-file" accept=".json">
            </div>
            
            <div class="form-group">
              <label for="import-json">Or paste JSON here</label>
              <textarea id="import-json" rows="10" placeholder='{"title": "...", "format": "mixed", "mixedSegments": [...]}'></textarea>
            </div>
            
            <button id="import-btn" class="btn btn-primary">Import Story</button>
            <div id="import-preview" class="import-preview hidden"></div>
          </section>

          <section class="form-section">
            <h3>üì• Bulk Import Words</h3>
            <p>Import multiple words from JSON array</p>
            
            <div class="form-group">
              <label for="import-words-file">Select JSON file</label>
              <input type="file" id="import-words-file" accept=".json">
              <small>JSON array of word objects</small>
            </div>
            
            <div class="form-group">
              <label for="import-words-json">Or paste JSON here</label>
              <textarea id="import-words-json" rows="8" placeholder='[{"arabic": "ŸÉÿ™ÿßÿ®", "transliteration": "kitab", "english": "book", "partOfSpeech": "noun"}, ...]'></textarea>
            </div>
            
            <button id="import-words-btn" class="btn btn-primary">Import Words</button>
            <button id="download-words-template-btn" class="btn btn-secondary" style="margin-left: 8px;">üìã Template</button>
            <div id="import-words-preview" class="import-preview hidden"></div>
          </section>

          <section class="form-section">
            <h3>üì§ Export Stories</h3>
            <p>Export all stories or selected story</p>
            
            <div class="form-group">
              <label>Export Options</label>
              <button id="export-all-btn" class="btn btn-secondary btn-block">Export All Stories</button>
            </div>
            
            <div class="form-group">
              <label>Download Templates</label>
              <div class="template-options">
                <button onclick="downloadTemplate('mixed')" class="btn btn-secondary">üéØ Single Format Template</button>
                <button onclick="downloadTemplate('bilingual')" class="btn btn-secondary">üìñ Bilingual Template</button>
              </div>
            </div>
          </section>
          
          <section class="form-section">
            <h3>üå± Quick Seed</h3>
            <p>Create sample stories instantly</p>
            
            <div class="form-group">
              <label>Create Sample Story</label>
              <div class="template-options">
                <button onclick="seedSampleStories('mixed')" class="btn btn-primary">üéØ Single (Mixed) Story</button>
                <button onclick="seedSampleStories('bilingual')" class="btn btn-secondary">üìñ Bilingual Story</button>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal hidden">
      <div class="modal-content">
        <h3>‚ö†Ô∏è Confirm Delete</h3>
        <p>Are you sure you want to delete this story? This action cannot be undone.</p>
        <div class="modal-actions">
          <button id="cancel-delete" class="btn btn-secondary">Cancel</button>
          <button id="confirm-delete" class="btn btn-danger">Delete</button>
        </div>
      </div>
    </div>

    <!-- Word Edit/Create Modal -->
    <div id="word-modal" class="modal hidden">
      <div class="modal-content modal-wide">
        <h3 id="word-modal-title">‚ûï Add New Word</h3>
        
        <form id="word-form">
          <input type="hidden" id="word-id">
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-arabic-input">Arabic *</label>
              <input type="text" id="word-arabic-input" dir="rtl" required placeholder="ŸÉŸÑŸÖÿ©">
            </div>
            <div class="form-group">
              <label for="word-english-input">English *</label>
              <input type="text" id="word-english-input" required placeholder="Translation">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-transliteration-input">Transliteration</label>
              <input type="text" id="word-transliteration-input" placeholder="Transliteration">
            </div>
            <div class="form-group">
              <label for="word-pos-input">Part of Speech</label>
              <select id="word-pos-input">
                <option value="">Select...</option>
                <option value="noun">Noun</option>
                <option value="verb">Verb</option>
                <option value="adjective">Adjective</option>
                <option value="adverb">Adverb</option>
                <option value="preposition">Preposition</option>
                <option value="pronoun">Pronoun</option>
                <option value="particle">Particle</option>
                <option value="interjection">Interjection</option>
                <option value="conjunction">Conjunction</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-difficulty-input">Difficulty Level</label>
              <select id="word-difficulty-input">
                <option value="1">1 - Beginner</option>
                <option value="2">2 - Elementary</option>
                <option value="3">3 - Intermediate</option>
                <option value="4">4 - Advanced</option>
                <option value="5">5 - Expert</option>
              </select>
            </div>
            <div class="form-group">
              <label for="word-category-input">Category</label>
              <select id="word-category-input">
                <option value="general">General</option>
                <option value="noun">Noun</option>
                <option value="verb">Verb</option>
                <option value="adjective">Adjective</option>
                <option value="adverb">Adverb</option>
                <option value="phrase">Phrase</option>
                <option value="greeting">Greeting</option>
                <option value="number">Number</option>
                <option value="time">Time</option>
                <option value="food">Food</option>
                <option value="travel">Travel</option>
                <option value="business">Business</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group form-group-wide">
              <label for="word-example-input">Example Usage (Arabic)</label>
              <input type="text" id="word-example-input" dir="rtl" placeholder="Example sentence using this word">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group form-group-wide">
              <label for="word-example-translation-input">Example Translation</label>
              <input type="text" id="word-example-translation-input" placeholder="English translation of example">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group form-group-wide">
              <label>Audio Pronunciation</label>
              <div class="audio-input-tabs">
                <button type="button" class="audio-tab active" data-tab="url" onclick="switchAudioTab('url')">üîó URL</button>
                <button type="button" class="audio-tab" data-tab="upload" onclick="switchAudioTab('upload')">üìÅ Upload</button>
              </div>
              <div id="audio-url-panel" class="audio-panel">
                <input type="url" id="word-audio-input" placeholder="https://example.com/audio.mp3">
                <small>Link to audio file for word pronunciation</small>
              </div>
              <div id="audio-upload-panel" class="audio-panel hidden">
                <input type="file" id="word-audio-file" accept="audio/*">
                <small>Upload audio file (MP3, WAV, M4A)</small>
                <div id="audio-upload-progress" class="upload-progress hidden"></div>
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group form-group-wide">
              <label for="word-root-input">Root Letters</label>
              <input type="text" id="word-root-input" dir="rtl" placeholder="ÿ£ÿµŸÑ ÿßŸÑŸÉŸÑŸÖÿ©">
            </div>
          </div>
        </form>
        
        <div class="modal-actions">
          <button id="cancel-word" class="btn btn-secondary">Cancel</button>
          <button id="save-word" class="btn btn-primary">Save Word</button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
      <div class="modal-content">
        <h3>‚öôÔ∏è API Settings</h3>
        <p>Configure the API base URL (leave empty for same-origin)</p>
        
        <div class="form-group">
          <label for="api-base-url">API Base URL</label>
          <input type="url" id="api-base-url" placeholder="http://localhost:5001/project/us-central1">
          <small>For local development with emulators</small>
        </div>
        
        <div class="modal-actions">
          <button id="cancel-settings" class="btn btn-secondary">Cancel</button>
          <button id="save-settings" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Templates -->
  <template id="segment-template">
    <div class="segment-card" data-index="{index}">
      <div class="segment-header">
        <span class="segment-number">Segment {number}</span>
        <button type="button" class="btn btn-icon btn-danger remove-segment">‚úï</button>
      </div>
      
      <!-- Bilingual Format Fields -->
      <div class="bilingual-fields">
        <div class="form-row">
          <div class="form-group form-group-wide">
            <label>Arabic Text *</label>
            <textarea class="segment-arabic" rows="3" dir="rtl" required placeholder="ÿßŸÑŸÜÿµ ÿßŸÑÿπÿ±ÿ®Ÿä"></textarea>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group form-group-wide">
            <label>English Text *</label>
            <textarea class="segment-english" rows="3" required placeholder="English translation"></textarea>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group form-group-wide">
            <label>Transliteration</label>
            <input type="text" class="segment-transliteration" placeholder="Arabic transliteration">
          </div>
        </div>
      </div>
      
      <!-- Mixed Format Fields (Hidden by default) -->
      <div class="mixed-fields hidden">
        <div class="content-parts-container">
          <!-- Content parts will be added here -->
        </div>
        <div class="segment-actions">
          <button type="button" class="btn btn-small btn-secondary add-text-part">+ Add Text</button>
          <button type="button" class="btn btn-small btn-secondary add-word-part">+ Add Arabic Word</button>
        </div>
      </div>
    </div>
  </template>

  <script src="admin.js"></script>
</body>
</html>
