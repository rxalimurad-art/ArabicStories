<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arabic Stories Admin</title>
  <link rel="stylesheet" href="admin.css">
  <style>
    /* Additional styles for mixed format */
    .format-selector {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .format-selector label {
      color: white;
      font-weight: 600;
    }
    
    .format-selector select {
      background: rgba(255,255,255,0.9);
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 16px;
      margin-left: 12px;
    }
    
    .format-info {
      font-size: 13px;
      opacity: 0.9;
      margin-top: 8px;
    }
    
    .mixed-segment-card {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border: 2px solid #667eea;
    }
    
    .content-part {
      background: white;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      border: 1px solid #e0e0e0;
    }
    
    .content-part[data-type="arabicWord"] {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-color: #2196f3;
    }
    
    .part-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .part-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      color: #666;
    }
    
    .content-part[data-type="arabicWord"] .part-label {
      color: #1976d2;
    }
    
    .remove-part {
      background: #ff5252;
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
    }
    
    .segment-actions {
      display: flex;
      gap: 8px;
      margin: 12px 0;
      padding: 12px;
      background: rgba(0,0,0,0.03);
      border-radius: 8px;
    }
    
    .segment-actions button {
      font-size: 13px;
      padding: 8px 16px;
    }
    
    .badge-format-mixed {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .badge-format-bilingual {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .template-options {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    
    .template-options button {
      font-size: 12px;
      padding: 6px 12px;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- App Header -->
    <header class="app-header">
      <div class="header-brand">
        <h1>üïå Arabic Stories Admin</h1>
      </div>
      <nav class="header-nav">
        <button class="nav-btn active" data-view="stories">üìö Stories</button>
        <button class="nav-btn" data-view="create">‚ûï New Story</button>
        <button class="nav-btn" data-view="words">üìù Words</button>
        <button class="nav-btn" data-view="import">üì§ Import</button>
      </nav>
      <div class="header-actions">
        <button id="settings-btn" class="btn btn-icon" title="API Settings">‚öôÔ∏è</button>
      </div>
    </header>

    <main class="app-main">
      <!-- Stories List View -->
      <div id="stories-view" class="view">
        <div class="view-header">
          <h2>üìö All Stories</h2>
          <div class="search-box">
            <input type="text" id="story-search" placeholder="Search stories...">
            <select id="story-format-filter">
              <option value="">All Formats</option>
              <option value="mixed">üéØ Mixed (Level 1)</option>
              <option value="bilingual">üìñ Bilingual (Level 2+)</option>
            </select>
            <button id="refresh-stories" class="btn btn-icon">üîÑ</button>
          </div>
        </div>
        
        <div id="stories-list" class="stories-grid">
          <div class="loading">Loading stories...</div>
        </div>
        
        <div id="stories-pagination" class="pagination hidden">
          <button id="prev-page" class="btn btn-secondary">Previous</button>
          <span id="page-info">Page 1</span>
          <button id="next-page" class="btn btn-secondary">Next</button>
        </div>
      </div>

      <!-- Create/Edit Story View -->
      <div id="create-view" class="view hidden">
        <div class="view-header">
          <h2 id="form-title">‚ûï Create New Story</h2>
          <div class="form-actions">
            <button id="validate-btn" class="btn btn-secondary">Validate</button>
            <button id="save-draft-btn" class="btn btn-secondary">Save Draft</button>
            <button id="publish-btn" class="btn btn-primary">Publish Story</button>
          </div>
        </div>

        <form id="story-form" class="story-form">
          <!-- Story Format Selector -->
          <div class="format-selector">
            <label for="story-format">üìñ Story Format</label>
            <select id="story-format" onchange="onFormatChange()">
              <option value="auto">üéØ Auto (Level 1 = Mixed, Level 2+ = Bilingual)</option>
              <option value="mixed">üéØ Mixed Format - English with Arabic words (Level 1)</option>
              <option value="bilingual">üìñ Bilingual Format - Full Arabic + English (Level 2+)</option>
            </select>
            <div class="format-info" id="format-info">
              üí° <strong>Mixed Format:</strong> Best for beginners. English text with embedded Arabic vocabulary words that users tap to learn.
            </div>
          </div>
          
          <!-- Basic Info Section -->
          <section class="form-section">
            <h3>üìñ Basic Information</h3>
            
            <div class="form-row">
              <div class="form-group">
                <label for="story-title">Title (English) *</label>
                <input type="text" id="story-title" required placeholder="Story title">
              </div>
              <div class="form-group">
                <label for="story-title-arabic">Title (Arabic)</label>
                <input type="text" id="story-title-arabic" dir="rtl" placeholder="ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÇÿµÿ©">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-wide">
                <label for="story-desc">Description (English) *</label>
                <textarea id="story-desc" rows="3" required placeholder="Brief description of the story"></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-wide">
                <label for="story-desc-arabic">Description (Arabic)</label>
                <textarea id="story-desc-arabic" rows="3" dir="rtl" placeholder="ŸàÿµŸÅ ŸÖŸàÿ¨ÿ≤ ŸÑŸÑŸÇÿµÿ©"></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="story-author">Author *</label>
                <input type="text" id="story-author" required placeholder="Author name">
              </div>
              <div class="form-group">
                <label for="story-difficulty">Difficulty Level *</label>
                <select id="story-difficulty" required onchange="onFormatChange()">
                  <option value="1">Level 1 - Beginner (Recommended: Mixed Format)</option>
                  <option value="2">Level 2 - Elementary (Recommended: Bilingual)</option>
                  <option value="3">Level 3 - Intermediate (Bilingual)</option>
                  <option value="4">Level 4 - Advanced (Bilingual)</option>
                  <option value="5">Level 5 - Expert (Bilingual)</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="story-category">Category *</label>
                <select id="story-category" required>
                  <option value="general">General</option>
                  <option value="folktale">Folktale</option>
                  <option value="history">History</option>
                  <option value="science">Science</option>
                  <option value="culture">Culture</option>
                  <option value="adventure">Adventure</option>
                  <option value="mystery">Mystery</option>
                  <option value="romance">Romance</option>
                  <option value="children">Children</option>
                  <option value="religious">Religious</option>
                  <option value="poetry">Poetry</option>
                  <option value="modern">Modern</option>
                </select>
              </div>
              <div class="form-group">
                <label for="story-tags">Tags (comma separated)</label>
                <input type="text" id="story-tags" placeholder="animals, friendship, adventure, level1">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-wide">
                <label for="story-cover">Cover Image URL</label>
                <input type="url" id="story-cover" placeholder="https://example.com/image.jpg">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-wide">
                <label for="story-audio">Audio Narration URL</label>
                <input type="url" id="story-audio" placeholder="https://example.com/audio.mp3">
              </div>
            </div>
          </section>

          <!-- Segments Section -->
          <section class="form-section">
            <div class="section-header">
              <h3 id="segments-section-title">üìù Story Segments</h3>
              <div>
                <button type="button" id="add-segment-btn" class="btn btn-small btn-primary">+ Add Segment</button>
                <button type="button" id="add-mixed-segment-btn" class="btn btn-small btn-secondary hidden">+ Add Mixed Segment</button>
              </div>
            </div>
            
            <div id="segments-container">
              <!-- Segments will be added here dynamically -->
            </div>
            
            <div id="empty-segments" class="empty-state">
              <p>No segments yet. Click "Add Segment" to start building your story.</p>
            </div>
          </section>

          <!-- Vocabulary Section -->
          <section class="form-section">
            <div class="section-header">
              <h3>üìö Vocabulary Words</h3>
              <button type="button" id="add-word-btn" class="btn btn-small btn-primary">+ Add Word</button>
            </div>
            
            <div id="words-container">
              <!-- Words will be added here dynamically -->
            </div>
            
            <div id="empty-words" class="empty-state">
              <p>No vocabulary words yet. Click "Add Word" to add words from the story.</p>
            </div>
            
            <div class="form-hint" style="margin-top: 12px; padding: 12px; background: #e3f2fd; border-radius: 8px;">
              üí° <strong>Tip:</strong> For mixed format stories, add vocabulary words here first, then reference them by ID in the Arabic word parts.
            </div>
          </section>
        </form>

        <!-- Validation Results -->
        <div id="validation-results" class="validation-panel hidden">
          <h4>Validation Results</h4>
          <div id="validation-content"></div>
        </div>
      </div>

      <!-- Words List View -->
      <div id="words-view" class="view hidden">
        <div class="view-header">
          <h2>üìù Generic Words</h2>
          <div class="search-box">
            <input type="text" id="word-search" placeholder="Search words...">
            <select id="word-category-filter">
              <option value="">All Categories</option>
            </select>
            <select id="word-difficulty-filter">
              <option value="">All Levels</option>
              <option value="1">Level 1</option>
              <option value="2">Level 2</option>
              <option value="3">Level 3</option>
              <option value="4">Level 4</option>
              <option value="5">Level 5</option>
            </select>
            <button id="refresh-words" class="btn btn-icon">üîÑ</button>
            <button id="add-word-main-btn" class="btn btn-primary">+ Add Word</button>
          </div>
        </div>
        
        <div id="words-list" class="words-grid">
          <div class="loading">Loading words...</div>
        </div>
        
        <div id="words-pagination" class="pagination hidden">
          <button id="word-prev-page" class="btn btn-secondary">Previous</button>
          <span id="word-page-info">Page 1</span>
          <button id="word-next-page" class="btn btn-secondary">Next</button>
        </div>
      </div>

      <!-- Import/Export View -->
      <div id="import-view" class="view hidden">
        <div class="view-header">
          <h2>üì§ Import / Export</h2>
        </div>

        <div class="import-export-grid">
          <section class="form-section">
            <h3>üì• Import Story</h3>
            <p>Import a story from JSON file</p>
            
            <div class="form-group">
              <label for="import-file">Select JSON file</label>
              <input type="file" id="import-file" accept=".json">
            </div>
            
            <div class="form-group">
              <label for="import-json">Or paste JSON here</label>
              <textarea id="import-json" rows="10" placeholder='{"title": "...", "format": "mixed", "mixedSegments": [...]}'></textarea>
            </div>
            
            <button id="import-btn" class="btn btn-primary">Import Story</button>
            <div id="import-preview" class="import-preview hidden"></div>
          </section>

          <section class="form-section">
            <h3>üì§ Export Stories</h3>
            <p>Export all stories or selected story</p>
            
            <div class="form-group">
              <label>Export Options</label>
              <button id="export-all-btn" class="btn btn-secondary btn-block">Export All Stories</button>
            </div>
            
            <div class="form-group">
              <label>Download Templates</label>
              <div class="template-options">
                <button onclick="downloadTemplate('mixed')" class="btn btn-secondary">üéØ Mixed Format Template</button>
                <button onclick="downloadTemplate('bilingual')" class="btn btn-secondary">üìñ Bilingual Template</button>
              </div>
            </div>
          </section>
          
          <section class="form-section">
            <h3>üå± Quick Seed</h3>
            <p>Create sample stories instantly</p>
            
            <div class="form-group">
              <label>Create Sample Story</label>
              <div class="template-options">
                <button onclick="seedSampleStories('mixed')" class="btn btn-primary">üéØ Level 1 Mixed Story</button>
                <button onclick="seedSampleStories('bilingual')" class="btn btn-secondary">üìñ Level 2+ Bilingual Story</button>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal hidden">
      <div class="modal-content">
        <h3>‚ö†Ô∏è Confirm Delete</h3>
        <p>Are you sure you want to delete this story? This action cannot be undone.</p>
        <div class="modal-actions">
          <button id="cancel-delete" class="btn btn-secondary">Cancel</button>
          <button id="confirm-delete" class="btn btn-danger">Delete</button>
        </div>
      </div>
    </div>

    <!-- Word Edit/Create Modal -->
    <div id="word-modal" class="modal hidden">
      <div class="modal-content modal-wide">
        <h3 id="word-modal-title">‚ûï Add New Word</h3>
        
        <form id="word-form">
          <input type="hidden" id="word-id">
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-arabic-input">Arabic *</label>
              <input type="text" id="word-arabic-input" dir="rtl" required placeholder="ŸÉŸÑŸÖÿ©">
            </div>
            <div class="form-group">
              <label for="word-english-input">English *</label>
              <input type="text" id="word-english-input" required placeholder="Translation">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-transliteration-input">Transliteration</label>
              <input type="text" id="word-transliteration-input" placeholder="Transliteration">
            </div>
            <div class="form-group">
              <label for="word-pos-input">Part of Speech</label>
              <select id="word-pos-input">
                <option value="">Select...</option>
                <option value="noun">Noun</option>
                <option value="verb">Verb</option>
                <option value="adjective">Adjective</option>
                <option value="adverb">Adverb</option>
                <option value="preposition">Preposition</option>
                <option value="pronoun">Pronoun</option>
                <option value="particle">Particle</option>
                <option value="interjection">Interjection</option>
                <option value="conjunction">Conjunction</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-root-input">Root Letters</label>
              <input type="text" id="word-root-input" dir="rtl" placeholder="ÿ£ÿµŸÑ ÿßŸÑŸÉŸÑŸÖÿ©">
            </div>
            <div class="form-group">
              <label for="word-difficulty-input">Difficulty Level</label>
              <select id="word-difficulty-input">
                <option value="1">1 - Beginner</option>
                <option value="2">2 - Elementary</option>
                <option value="3">3 - Intermediate</option>
                <option value="4">4 - Advanced</option>
                <option value="5">5 - Expert</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-category-input">Category</label>
              <select id="word-category-input">
                <option value="general">General</option>
                <option value="noun">Noun</option>
                <option value="verb">Verb</option>
                <option value="adjective">Adjective</option>
                <option value="adverb">Adverb</option>
                <option value="phrase">Phrase</option>
                <option value="greeting">Greeting</option>
                <option value="number">Number</option>
                <option value="time">Time</option>
                <option value="food">Food</option>
                <option value="travel">Travel</option>
                <option value="business">Business</option>
              </select>
            </div>
            <div class="form-group">
              <label for="word-tags-input">Tags (comma separated)</label>
              <input type="text" id="word-tags-input" placeholder="common, daily, formal">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group form-group-wide">
              <label for="word-example-input">Example Sentence (Arabic)</label>
              <input type="text" id="word-example-input" dir="rtl" placeholder="Example usage">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group form-group-wide">
              <label for="word-example-translation-input">Example Translation</label>
              <input type="text" id="word-example-translation-input" placeholder="English translation">
            </div>
          </div>
        </form>
        
        <div class="modal-actions">
          <button id="cancel-word" class="btn btn-secondary">Cancel</button>
          <button id="save-word" class="btn btn-primary">Save Word</button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
      <div class="modal-content">
        <h3>‚öôÔ∏è API Settings</h3>
        <p>Configure the API base URL (leave empty for same-origin)</p>
        
        <div class="form-group">
          <label for="api-base-url">API Base URL</label>
          <input type="url" id="api-base-url" placeholder="http://localhost:5001/project/us-central1">
          <small>For local development with emulators</small>
        </div>
        
        <div class="modal-actions">
          <button id="cancel-settings" class="btn btn-secondary">Cancel</button>
          <button id="save-settings" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Templates -->
  <template id="segment-template">
    <div class="segment-card" data-index="{index}">
      <div class="segment-header">
        <span class="segment-number">Segment {number}</span>
        <button type="button" class="btn btn-icon btn-danger remove-segment">‚úï</button>
      </div>
      
      <div class="form-row">
        <div class="form-group form-group-wide">
          <label>Arabic Text *</label>
          <textarea class="segment-arabic" rows="3" dir="rtl" required placeholder="ÿßŸÑŸÜÿµ ÿßŸÑÿπÿ±ÿ®Ÿä"></textarea>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group form-group-wide">
          <label>English Text *</label>
          <textarea class="segment-english" rows="3" required placeholder="English translation"></textarea>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group form-group-wide">
          <label>Transliteration</label>
          <input type="text" class="segment-transliteration" placeholder="Arabic transliteration">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Audio Start (seconds)</label>
          <input type="number" class="segment-audio-start" min="0" step="0.1" placeholder="0.0">
        </div>
        <div class="form-group">
          <label>Audio End (seconds)</label>
          <input type="number" class="segment-audio-end" min="0" step="0.1" placeholder="0.0">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group form-group-wide">
          <label>Grammar Note</label>
          <input type="text" class="segment-grammar-note" placeholder="Optional grammar explanation">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group form-group-wide">
          <label>Cultural Note</label>
          <input type="text" class="segment-cultural-note" placeholder="Optional cultural context">
        </div>
      </div>
    </div>
  </template>

  <template id="word-template">
    <div class="word-card" data-index="{index}">
      <div class="word-header">
        <span class="word-number">Word {number}</span>
        <button type="button" class="btn btn-icon btn-danger remove-word">‚úï</button>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Arabic *</label>
          <input type="text" class="word-arabic" dir="rtl" required placeholder="ŸÉŸÑŸÖÿ©">
        </div>
        <div class="form-group">
          <label>English *</label>
          <input type="text" class="word-english" required placeholder="Translation">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Transliteration</label>
          <input type="text" class="word-transliteration" placeholder="Transliteration">
        </div>
        <div class="form-group">
          <label>Part of Speech</label>
          <select class="word-pos">
            <option value="">Select...</option>
            <option value="noun">Noun</option>
            <option value="verb">Verb</option>
            <option value="adjective">Adjective</option>
            <option value="adverb">Adverb</option>
            <option value="preposition">Preposition</option>
            <option value="pronoun">Pronoun</option>
            <option value="particle">Particle</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group form-group-wide">
          <label>Root Letters</label>
          <input type="text" class="word-root" dir="rtl" placeholder="ÿ£ÿµŸÑ ÿßŸÑŸÉŸÑŸÖÿ©">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group form-group-wide">
          <label>Example Sentence</label>
          <input type="text" class="word-example" dir="rtl" placeholder="Example usage">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group form-group-wide">
          <label>Word ID (for referencing in mixed format)</label>
          <input type="text" class="word-id-display" readonly placeholder="Will be generated automatically">
        </div>
      </div>
    </div>
  </template>

  <script src="admin.js"></script>
</body>
</html>
