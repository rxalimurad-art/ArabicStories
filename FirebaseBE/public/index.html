<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arabic Stories Admin</title>
  <link rel="stylesheet" href="admin.css">
  <style>
    /* Format selector styling */
    .format-selector-inline {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .format-selector-inline label {
      font-weight: 600;
      color: var(--gray-700);
      white-space: nowrap;
    }
    
    .format-selector-inline select {
      padding: 10px 16px;
      border: 2px solid var(--primary);
      border-radius: 8px;
      font-size: 15px;
      background: white;
      min-width: 180px;
    }
    
    .format-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .format-badge.mixed {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
    }
    
    .format-badge.bilingual {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
    }
    
    /* Segment styling based on format */
    .segment-card.mixed-format {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border: 2px solid #4caf50;
    }
    
    .segment-card.bilingual-format {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border: 2px solid #2196f3;
    }
    
    .segment-format-label {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: inline-block;
    }
    
    .segment-card.mixed-format .segment-format-label {
      color: #2e7d32;
    }
    
    .segment-card.bilingual-format .segment-format-label {
      color: #1565c0;
    }
    
    /* Simplified mixed format segments */
    .segment-card.mixed-format .form-group {
      margin: 12px 16px;
    }
    
    .segment-card.mixed-format textarea {
      width: 100%;
      font-size: 15px;
      line-height: 1.6;
    }
    
    /* Word card with audio */
    .word-audio-input {
      width: 100%;
    }
    
    /* Simplified form sections */
    .form-section.compact {
      padding: 16px;
    }
    
    .form-section-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .form-section-title h3 {
      margin: 0;
    }
    
    .format-display {
      font-size: 13px;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 600;
    }
    
    /* Audio input tabs */
    .audio-input-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .audio-tab {
      flex: 1;
      padding: 8px 16px;
      border: 2px solid var(--gray-300);
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .audio-tab:hover {
      border-color: var(--primary);
    }
    
    .audio-tab.active {
      border-color: var(--primary);
      background: var(--primary);
      color: white;
    }
    
    .audio-panel {
      animation: fadeIn 0.2s ease;
    }
    
    .upload-progress {
      margin-top: 8px;
      height: 4px;
      background: var(--gray-200);
      border-radius: 2px;
      overflow: hidden;
    }
    
    .upload-progress-bar {
      height: 100%;
      background: var(--primary);
      border-radius: 2px;
      transition: width 0.3s ease;
    }
    
    /* Import words preview */
    .words-preview-list {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 12px;
    }
    
    .word-preview-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      background: var(--gray-100);
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    .word-preview-arabic {
      font-size: 18px;
      font-weight: 600;
      min-width: 100px;
    }
    
    .word-preview-info {
      flex: 1;
      font-size: 13px;
      color: var(--gray-600);
    }
    
    .word-preview-status {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 12px;
    }
    
    .word-preview-status.pending {
      background: var(--warning);
      color: white;
    }
    
    .word-preview-status.success {
      background: var(--success);
      color: white;
    }
    
    .word-preview-status.error {
      background: var(--danger);
      color: white;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- App Header -->
    <header class="app-header">
      <div class="header-brand">
        <h1>üïå Arabic Stories Admin</h1>
      </div>
      <nav class="header-nav">
        <button class="nav-btn active" data-view="stories">üìö Stories</button>
        <button class="nav-btn" data-view="create">‚ûï New Story</button>
        <button class="nav-btn" data-view="words">üìñ Words</button>
        <button class="nav-btn" data-view="roots">üå≥ Roots</button>
        <button class="nav-btn" data-view="import">üì§ Import</button>
      </nav>
      <div class="header-actions">
        <button id="settings-btn" class="btn btn-icon" title="API Settings">‚öôÔ∏è</button>
      </div>
    </header>

    <main class="app-main">
      <!-- Stories List View -->
      <div id="stories-view" class="view">
        <div class="view-header">
          <h2>üìö All Stories</h2>
          <div class="search-box">
            <input type="text" id="story-search" placeholder="Search stories...">
            <select id="story-format-filter">
              <option value="">All Formats</option>
              <option value="mixed">üéØ Single (Mixed)</option>
              <option value="bilingual">üìñ Bilingual</option>
            </select>
            <button id="refresh-stories" class="btn btn-icon">üîÑ</button>
          </div>
        </div>
        
        <div id="stories-list" class="stories-grid">
          <div class="loading">Loading stories...</div>
        </div>
        
        <div id="stories-pagination" class="pagination hidden">
          <button id="prev-page" class="btn btn-secondary">Previous</button>
          <span id="page-info">Page 1</span>
          <button id="next-page" class="btn btn-secondary">Next</button>
        </div>
      </div>

      <!-- Create/Edit Story View -->
      <div id="create-view" class="view hidden">
        <div class="view-header">
          <h2 id="form-title">‚ûï Create New Story</h2>
          <div class="form-actions">
            <button id="validate-btn" class="btn btn-secondary">Validate</button>
            <button id="save-draft-btn" class="btn btn-secondary">Save Draft</button>
            <button id="publish-btn" class="btn btn-primary">Publish Story</button>
          </div>
        </div>

        <form id="story-form" class="story-form">
          <input type="hidden" id="story-id">
          <!-- Basic Info Section -->
          <section class="form-section compact">
            <div class="form-section-title">
              <h3>üìñ Basic Information</h3>
              <span id="current-format-display" class="format-display mixed">üéØ Single</span>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="story-title">Title (English) *</label>
                <input type="text" id="story-title" required placeholder="Story title">
              </div>
              <div class="form-group">
                <label for="story-title-arabic">Title (Arabic)</label>
                <input type="text" id="story-title-arabic" dir="rtl" placeholder="ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÇÿµÿ©">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-wide">
                <label for="story-desc">Description (English) *</label>
                <textarea id="story-desc" rows="2" required placeholder="Brief description of the story"></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group form-group-wide">
                <label for="story-desc-arabic">Description (Arabic)</label>
                <textarea id="story-desc-arabic" rows="2" dir="rtl" placeholder="ŸàÿµŸÅ ŸÖŸàÿ¨ÿ≤ ŸÑŸÑŸÇÿµÿ©"></textarea>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="story-author">Author *</label>
                <input type="text" id="story-author" required placeholder="Author name">
              </div>
              <div class="form-group format-selector-inline">
                <label for="story-format">Format *</label>
                <select id="story-format" required>
                  <option value="mixed">üéØ Single (Mixed)</option>
                  <option value="bilingual">üìñ Bilingual</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="story-difficulty">Difficulty Level *</label>
                <select id="story-difficulty" required>
                  <option value="1">Level 1 - Beginner</option>
                  <option value="2">Level 2 - Elementary</option>
                  <option value="3">Level 3 - Intermediate</option>
                  <option value="4">Level 4 - Advanced</option>
                  <option value="5">Level 5 - Expert</option>
                </select>
              </div>
              <div class="form-group">
                <label for="story-category">Category *</label>
                <select id="story-category" required>
                  <option value="general">General</option>
                  <option value="folktale">Folktale</option>
                  <option value="history">History</option>
                  <option value="science">Science</option>
                  <option value="culture">Culture</option>
                  <option value="adventure">Adventure</option>
                  <option value="mystery">Mystery</option>
                  <option value="romance">Romance</option>
                  <option value="children">Children</option>
                  <option value="religious">Religious</option>
                  <option value="poetry">Poetry</option>
                  <option value="modern">Modern</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="story-tags">Tags (comma separated)</label>
                <input type="text" id="story-tags" placeholder="beginner, vocabulary, mixed">
              </div>
              <div class="form-group form-group-wide">
                <label for="story-cover">Cover Image URL</label>
                <input type="url" id="story-cover" placeholder="https://example.com/image.jpg">
              </div>
            </div>
          </section>

          <!-- Story Segments Section -->
          <section class="form-section">
            <div class="section-header">
              <h3 id="segments-section-title">üìù Story Segments</h3>
              <button type="button" id="add-segment-btn" class="btn btn-small btn-primary">+ Add Segment</button>
            </div>
            
            <div id="segments-container">
              <!-- Segments will be added here dynamically -->
            </div>
            
            <div id="empty-segments" class="empty-state">
              <p>No segments yet. Click "Add Segment" to start building your story.</p>
            </div>
          </section>
        </form>

        <!-- Validation Results -->
        <div id="validation-results" class="validation-panel hidden">
          <h4>Validation Results</h4>
          <div id="validation-content"></div>
        </div>
      </div>

      <!-- Words List View -->
      <div id="words-view" class="view hidden">
        <div class="view-header">
          <h2>üìñ Quran Words</h2>
          <div class="search-box">
            <input type="text" id="word-search" placeholder="Search Arabic, English, or Buckwalter...">
            <select id="word-pos-filter">
              <option value="">All POS</option>
              <option value="N">N - Noun</option>
              <option value="V">V - Verb</option>
              <option value="P">P - Preposition</option>
              <option value="PN">PN - Proper Noun</option>
              <option value="ADJ">ADJ - Adjective</option>
              <option value="ADV">ADV - Adverb</option>
              <option value="PRO">PRO - Pronoun</option>
              <option value="CONJ">CONJ - Conjunction</option>
            </select>
            <select id="word-form-filter">
              <option value="">All Forms</option>
              <option value="1">Form I</option>
              <option value="2">Form II</option>
              <option value="3">Form III</option>
              <option value="4">Form IV</option>
              <option value="5">Form V</option>
              <option value="6">Form VI</option>
              <option value="7">Form VII</option>
              <option value="8">Form VIII</option>
              <option value="9">Form IX</option>
              <option value="10">Form X</option>
            </select>
            <select id="word-sort">
              <option value="rank">Sort by Rank</option>
              <option value="occurrenceCount">Sort by Occurrences</option>
              <option value="arabicText">Sort by Arabic</option>
            </select>
            <button id="refresh-words" class="btn btn-icon">üîÑ</button>
            <select id="word-limit">
              <option value="50">50</option>
              <option value="100" selected>100</option>
              <option value="200">200</option>
              <option value="500">500</option>
              <option value="1000">1000</option>
              <option value="5000">5000</option>
              <option value="10000">10000</option>
              <option value="all">Show All</option>
            </select>
          </div>
        </div>
        
        <div id="words-count-display" style="margin: 16px 0; padding: 12px 16px; background: var(--gray-100); border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
          <span id="words-count-text">Loading count...</span>
          <span id="words-showing-text"></span>
        </div>
        
        <div id="words-list" class="words-grid">
          <div class="loading">Loading words...</div>
        </div>
        
        <div id="words-pagination" class="pagination hidden">
          <button id="word-prev-page" class="btn btn-secondary">Previous</button>
          <span id="word-page-info">Page 1</span>
          <button id="word-next-page" class="btn btn-secondary">Next</button>
        </div>
      </div>

      <!-- Quran Roots View -->
      <div id="roots-view" class="view hidden">
        <div class="view-header">
          <h2>üå≥ Quran Roots</h2>
          <div class="search-box">
            <input type="text" id="root-search" placeholder="Search roots...">
            <select id="root-sort">
              <option value="totalOccurrences">Sort by Occurrences</option>
              <option value="derivativeCount">Sort by Derivatives</option>
              <option value="root">Sort by Root</option>
            </select>
            <select id="root-limit">
              <option value="50">50</option>
              <option value="100" selected>100</option>
              <option value="200">200</option>
              <option value="500">500</option>
              <option value="all">Show All</option>
            </select>
            <button id="refresh-roots" class="btn btn-icon">üîÑ</button>
          </div>
        </div>
        
        <div id="roots-count-display" style="margin: 16px 0; padding: 12px 16px; background: var(--gray-100); border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
          <span id="roots-count-text">Loading roots...</span>
          <span id="roots-showing-text"></span>
        </div>
        
        <div id="roots-list" class="words-grid">
          <div class="loading">Loading roots...</div>
        </div>
        
        <div id="roots-pagination" class="pagination hidden">
          <button id="root-prev-page" class="btn btn-secondary">Previous</button>
          <span id="root-page-info">Page 1</span>
          <button id="root-next-page" class="btn btn-secondary">Next</button>
        </div>
      </div>

      <!-- Import/Export View -->
      <div id="import-view" class="view hidden">
        <div class="view-header">
          <h2>üì§ Import / Export</h2>
        </div>

        <div class="import-export-grid">
          <section class="form-section">
            <h3>üì• Import Story</h3>
            <p>Import a story from JSON file</p>
            
            <div class="form-group">
              <label for="import-file">Select JSON file</label>
              <input type="file" id="import-file" accept=".json">
            </div>
            
            <div class="form-group">
              <label for="import-json">Or paste JSON here</label>
              <textarea id="import-json" rows="10" placeholder='{"title": "...", "format": "mixed", "mixedSegments": [...]}'></textarea>
            </div>
            
            <button id="import-btn" class="btn btn-primary">Import Story</button>
            <div id="import-preview" class="import-preview hidden"></div>
          </section>

          <section class="form-section">
            <h3>üìä Quran Statistics</h3>
            <p>View statistics from quran_stats collection</p>
            <div id="quran-stats-container">
              <div class="loading">Loading statistics...</div>
            </div>
          </section>

          <section class="form-section">
            <h3>üì§ Export Stories</h3>
            <p>Export all stories or selected story</p>
            
            <div class="form-group">
              <label>Export Options</label>
              <button id="export-all-btn" class="btn btn-secondary btn-block">Export All Stories</button>
            </div>
            
            <div class="form-group">
              <label>Download Templates</label>
              <div class="template-options">
                <button onclick="downloadTemplate('mixed')" class="btn btn-secondary">üéØ Single Format Template</button>
                <button onclick="downloadTemplate('bilingual')" class="btn btn-secondary">üìñ Bilingual Template</button>
              </div>
            </div>
          </section>
          
          <section class="form-section">
            <h3>üå± Quick Seed</h3>
            <p>Create sample stories instantly</p>
            
            <div class="form-group">
              <label>Create Sample Story</label>
              <div class="template-options">
                <button onclick="seedSampleStories('mixed')" class="btn btn-primary">üéØ Single (Mixed) Story</button>
                <button onclick="seedSampleStories('bilingual')" class="btn btn-secondary">üìñ Bilingual Story</button>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal hidden">
      <div class="modal-content">
        <h3>‚ö†Ô∏è Confirm Delete</h3>
        <p>Are you sure you want to delete this story? This action cannot be undone.</p>
        <div class="modal-actions">
          <button id="cancel-delete" class="btn btn-secondary">Cancel</button>
          <button id="confirm-delete" class="btn btn-danger">Delete</button>
        </div>
      </div>
    </div>



    <!-- Word View/Edit Modal -->
    <div id="word-modal" class="modal hidden">
      <div class="modal-content modal-wide">
        <h3 id="word-modal-title">üìñ Word Details</h3>
        
        <form id="word-form">
          <input type="hidden" id="word-id">
          
          <!-- Core Fields -->
          <div class="form-row">
            <div class="form-group">
              <label for="word-arabic-input">Arabic Text</label>
              <input type="text" id="word-arabic-input" dir="rtl" readonly style="background: var(--gray-100);">
            </div>
            <div class="form-group">
              <label for="word-english-input">English Meaning</label>
              <input type="text" id="word-english-input" readonly style="background: var(--gray-100);">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-buckwalter-input">Buckwalter</label>
              <input type="text" id="word-buckwalter-input" readonly style="background: var(--gray-100);">
            </div>
            <div class="form-group">
              <label for="word-pos-input">Part of Speech</label>
              <input type="text" id="word-pos-input" readonly style="background: var(--gray-100);">
            </div>
          </div>
          
          <!-- Root Information -->
          <div class="form-row">
            <div class="form-group">
              <label for="word-root-input">Root (Arabic)</label>
              <input type="text" id="word-root-input" dir="rtl" readonly style="background: var(--gray-100);">
            </div>
            <div class="form-group">
              <label for="word-root-transliteration-input">Root Transliteration</label>
              <input type="text" id="word-root-transliteration-input" readonly style="background: var(--gray-100);">
            </div>
          </div>
          
          <!-- Statistics -->
          <div class="form-row">
            <div class="form-group">
              <label for="word-rank-input">Rank</label>
              <input type="number" id="word-rank-input" readonly style="background: var(--gray-100);">
            </div>
            <div class="form-group">
              <label for="word-occurrence-count-input">Occurrence Count</label>
              <input type="number" id="word-occurrence-count-input" readonly style="background: var(--gray-100);">
            </div>
          </div>
          
          <!-- Morphology Details -->
          <div class="form-row">
            <div class="form-group">
              <label for="word-lemma-input">Lemma</label>
              <input type="text" id="word-lemma-input" dir="rtl" readonly style="background: var(--gray-100);">
            </div>
            <div class="form-group">
              <label for="word-form-input">Form</label>
              <input type="text" id="word-form-input" readonly style="background: var(--gray-100);">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-tense-input">Tense</label>
              <input type="text" id="word-tense-input" readonly style="background: var(--gray-100);">
            </div>
            <div class="form-group">
              <label for="word-gender-input">Gender</label>
              <input type="text" id="word-gender-input" readonly style="background: var(--gray-100);">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-number-input">Number</label>
              <input type="text" id="word-number-input" readonly style="background: var(--gray-100);">
            </div>
            <div class="form-group">
              <label for="word-case-input">Grammatical Case</label>
              <input type="text" id="word-case-input" readonly style="background: var(--gray-100);">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="word-pos-description-input">POS Description</label>
              <input type="text" id="word-pos-description-input" dir="rtl" readonly style="background: var(--gray-100);">
            </div>
            <div class="form-group">
              <label for="word-passive-input">Passive Voice</label>
              <input type="text" id="word-passive-input" readonly style="background: var(--gray-100);">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group form-group-wide">
              <label for="word-breakdown-input">Morphological Breakdown</label>
              <input type="text" id="word-breakdown-input" readonly style="background: var(--gray-100);">
            </div>
          </div>
        </form>
        
        <div class="modal-actions">
          <button id="cancel-word" class="btn btn-secondary">Close</button>
          <button id="edit-word-btn" class="btn btn-primary" onclick="enableWordEdit()">‚úèÔ∏è Edit</button>
          <button id="save-word-btn" class="btn btn-primary hidden" onclick="saveWord()">üíæ Save</button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
      <div class="modal-content">
        <h3>‚öôÔ∏è API Settings</h3>
        <p>Configure the API base URL (leave empty for same-origin)</p>
        
        <div class="form-group">
          <label for="api-base-url">API Base URL</label>
          <input type="url" id="api-base-url" placeholder="http://localhost:5001/project/us-central1">
          <small>For local development with emulators</small>
        </div>
        
        <div class="modal-actions">
          <button id="cancel-settings" class="btn btn-secondary">Cancel</button>
          <button id="save-settings" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>



  <script src="admin.js"></script>
</body>
</html>
